@using Quilt4Net.Toolkit.Features.ApplicationInsights

<RadzenRow Style="margin-bottom: 6px;" Visible="@(ShowRangeSelector || ShowEnvironmentSelector)">
    <RadzenColumn Visible="@ShowRangeSelector">
        <RadzenStack Orientation="Orientation.Vertical" Gap="0">
            <RadzenText TextStyle="TextStyle.Caption" Text="Range"/>
            <LogRangeSelector OnSelected="OnRangeSelected" />
        </RadzenStack>
    </RadzenColumn>
    <RadzenColumn Visible="@ShowEnvironmentSelector">
        <RadzenStack Orientation="Orientation.Vertical" Gap="0">
            <RadzenText TextStyle="TextStyle.Caption" Text="Environment" />
            <LogEnvironmentSelector OnSelected="OnEnvironmentSelected" Context="@Context" />
        </RadzenStack>
    </RadzenColumn>
</RadzenRow>

<RadzenTabs Change="StateHasChanged">
    <Tabs>
        <RadzenTabsItem Text="Search">
            <LogSearchView Range="@RangeToUse" Environment="@EnvironmentToUse" Context="Context" />
        </RadzenTabsItem>
        <RadzenTabsItem Text="Summary">
            <LogSummaryListView Range="@RangeToUse" Environment="@EnvironmentToUse"  Context="Context" />
        </RadzenTabsItem>
        <RadzenTabsItem Text="Measure">
            <LogMeasureView Range="@RangeToUse" Environment="@EnvironmentToUse" Context="Context" />
        </RadzenTabsItem>
        <RadzenTabsItem Text="Count">
            <LogCountView Range="@RangeToUse" Environment="@EnvironmentToUse" Context="Context" />
        </RadzenTabsItem>
        <RadzenTabsItem Text="Trigger" Visible="@(Context == null)">
            <LogTriggerView Context="Context" />
        </RadzenTabsItem>
    </Tabs>
</RadzenTabs>

@code {
    private LogRangeSelector.TimeRangeOption _range;
    private EnvironmentOption _environment;

    [Parameter]
    public bool ShowRangeSelector { get; set; } = true;

    [Parameter]
    public TimeSpan? Range { get; set; }

    [Parameter]
    public bool ShowEnvironmentSelector { get; set; } = true;

    [Parameter]
    public string Environment { get; set; }

    [Parameter]
    public IApplicationInsightsContext Context { get; set; }

    private TimeSpan RangeToUse => ShowRangeSelector
        ? _range
        : (Range ?? TimeSpan.Zero);
    private string EnvironmentToUse => ShowEnvironmentSelector
        ? _environment
        : Environment;

    private void OnRangeSelected(LogRangeSelector.TimeRangeOption range)
    {
        _range = range;
        StateHasChanged();
    }

    private void OnEnvironmentSelected(EnvironmentOption environment)
    {
        _environment = environment;
        StateHasChanged();
    }
}