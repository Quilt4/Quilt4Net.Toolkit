@using Microsoft.Extensions.Hosting
@using Quilt4Net.Toolkit.Features.ApplicationInsights
@inject IApplicationInsightsService ApplicationInsightsService
@inject IHostEnvironment HostEnvironment

@if (Model == null)
{
    <Loading />
}
else
{
    <ul>
    @foreach (var item in Model)
    {
        <li>@item.Elapsed</li>
    }
    </ul>
}

@code {
    private MeasureData[] Model { get; set; }

    [Parameter]
    public TimeSpan Range { get; set; } = TimeSpan.FromDays(1);

    [Parameter]
    public IApplicationInsightsContext Context { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        Model = null;
        Model = await ApplicationInsightsService
            .GetMeasureAsync(Context, HostEnvironment.EnvironmentName, Range)
            .ToArrayAsync();
    }
}
